<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monetizelt</title>

    <!-- Description principale -->
    <meta name="description"
        content="Your market, your rules. Monetizelt lets you sell time-limited digital videos easily. Generate, share, and cash in with full control.">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://monetizelt.com/" />

    <!-- Open Graph (Facebook, LinkedIn, etc.) -->
    <meta property="og:title" content="Monetizelt — Sell and Share Your Digital Videos" />
    <meta property="og:description"
        content="Create your own market, share videos, and get paid instantly with Monetizelt." />
    <meta property="og:url" content="https://g-z.online/" />
    <meta property="og:type" content="website" />
    <meta property="og:image"
        content="https://firebasestorage.googleapis.com/v0/b/monetizelt-b235d.firebasestorage.app/o/1000009017_resized.jpg?alt=media&token=d69084a3-b285-44e4-81a5-f05971314175" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Monetizelt — Sell and Share Your Digital Videos" />
    <meta name="twitter:description"
        content="Create your own market, share videos, and get paid instantly with Monetizelt." />
    <meta name="twitter:image"
        content="https://firebasestorage.googleapis.com/v0/b/monetizelt-b235d.firebasestorage.app/o/1000009017_resized.jpg?alt=media&token=d69084a3-b285-44e4-81a5-f05971314175" />

    <!-- Favicon -->
    <link rel="icon"
        href="https://firebasestorage.googleapis.com/v0/b/monetizelt-b235d.firebasestorage.app/o/1000009017_resized.jpg?alt=media&token=d69084a3-b285-44e4-81a5-f05971314175" />

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        :root {
            --primary-color: #007BFF;
            --primary-dark: #0056b3;
            --background-color: #f5f5f5;
            --text-color: #333;
            --white: #ffffff;
            --error-color: #ff3333;
            --success-color: #28a745;
            --warning-color: #ffc107;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.3;
            font-size: 13px;
            overflow-x: hidden;
        }

        header {
            background-color: var(--white);
            padding: 10px 15px;
            display: flex;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 3em;
            /* Smaller size to avoid logo being too large */
            font-family: 'Poppins', sans-serif;
            color: var(--primary-color);
            border: 1.5px solid var(--primary-color);
            padding: 0px 11px;
            border-radius: 13px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .divider {
            height: 2px;
            background: linear-gradient(to right, transparent, var(--primary-color), transparent);
            width: 100%;
            margin: 2px 0;
        }

        .form-container {
            padding: 12px;
            text-align: center;
            background-color: #e9f5ff;
            border: 1px solid var(--primary-color);
            border-radius: 30px;
            margin: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            animation: slideUp 0.8s ease-out;
            position: relative;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .button {
            display: block;
            background-color: #0077BE;
            border: 1px solid var(--primary-color);
            border-radius: 15px;
            padding: 10px;
            margin: 12px auto;
            text-decoration: none;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 80%;
            max-width: 300px;
            text-align: center;
            position: relative;
        }

        .button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .form-container input,
        .form-container select,
        .form-container textarea {
            padding: 10px;
            border: 1px solid var(--primary-color);
            border-radius: 15px;
            width: 80%;
            max-width: 300px;
            margin-bottom: 12px;
            font-size: 13px;
            -webkit-appearance: none;
            appearance: none;
            /* Prevent zoom on mobile */
            max-height: 40px;
        }

        .toggle-button {
            cursor: pointer;
            margin: 12px;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 8px 12px;
            border-radius: 10px;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .toggle-button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        h2 {
            margin-bottom: 20px;
            font-size: 32px;
            color: var(--primary-dark);
            font-family: 'Billabong', cursive;
            font-weight: normal;
        }

        .forgot-password {
            margin-top: 12px;
            color: var(--primary-color);
            cursor: pointer;
            border: 1px solid var(--primary-color);
            padding: 8px 12px;
            border-radius: 10px;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .forgot-password:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .message {
            margin: 12px auto;
            padding: 10px;
            border-radius: 10px;
            max-width: 300px;
            font-size: 13px;
            display: flex;
            align-items: center;
            animation: fadeIn 0.3s ease;
            line-height: 1.4;
        }

        .message i {
            margin-right: 8px;
            font-size: 15px;
        }

        .message.error {
            background-color: rgba(255, 51, 51, 0.1);
            color: var(--error-color);
            border: 1px solid rgba(255, 51, 51, 0.3);
        }

        .message.success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .message.warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #856404;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .message.info {
            background-color: rgba(0, 123, 255, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(0, 123, 255, 0.3);
        }

        .footer-links {
            margin-top: 18px;
            font-size: 11px;
        }

        .footer-links a {
            color: var(--primary-color);
            text-decoration: none;
            margin: 0 10px;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background-color: var(--primary-color);
            width: 0;
            z-index: 1100;
            transition: width 0.3s ease;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            vertical-align: middle;
        }

        .spinner.hidden {
            display: none;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 123, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        .password-strength {
            width: 80%;
            max-width: 300px;
            height: 4px;
            background-color: #ddd;
            margin: 4px auto 12px;
            border-radius: 10px;
            overflow: hidden;
        }

        .password-strength-meter {
            height: 100%;
            width: 0;
            transition: width 0.3s ease, background-color 0.3s ease;
        }

        .password-feedback {
            font-size: 11px;
            margin-bottom: 12px;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            background-color: var(--primary-color);
            padding: 5px;
            border-radius: 3px;
            filter: invert(1);
        }

        .date-label {
            font-size: 12px;
            color: var(--primary-dark);
            margin-bottom: 5px;
            text-align: left;
            width: 80%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .account-type-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .account-type-btn {
            padding: 8px 16px;
            border: 1px solid var(--primary-color);
            background-color: var(--white);
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .account-type-btn:first-child {
            border-radius: 15px 0 0 15px;
        }

        .account-type-btn:last-child {
            border-radius: 0 15px 15px 0;
        }

        .account-type-btn.active {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .field-group {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .field-group.active {
            display: block;
        }

        .form-section {
            margin-bottom: 15px;
        }

        .form-section-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-dark);
        }

        .loading-dots {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            height: 16px;
        }

        .loading-dots .dot {
            width: 6px;
            height: 6px;
            background-color: white;
            border-radius: 50%;
            margin: 0 3px;
            animation: dotPulse 1.4s infinite ease-in-out;
        }

        .loading-dots .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading-dots .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        .loading-dots.hidden {
            display: none;
        }

        .input-feedback {
            font-size: 11px;
            color: var(--primary-color);
            margin: -8px auto 8px;
            max-width: 300px;
            text-align: left;
            padding-left: 10%;
        }

        .phone-input-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80%;
            max-width: 300px;
            margin: 0 auto 12px;
        }

        .phone-prefix {
            border: 1px solid var(--primary-color);
            border-right: none;
            border-radius: 15px 0 0 15px;
            padding: 10px;
            background-color: #f0f8ff;
            width: 25%;
            text-align: center;
            font-size: 13px;
            max-height: 40px;
        }

        .phone-number {
            border: 1px solid var(--primary-color);
            border-left: none;
            border-radius: 0 15px 15px 0;
            padding: 10px;
            width: 75%;
            font-size: 13px;
            max-height: 40px;
        }

        .address-suggestions {
            width: 80%;
            max-width: 300px;
            margin: -8px auto 12px;
            text-align: left;
            background-color: white;
            border: 1px solid var(--primary-color);
            border-radius: 10px;
            max-height: 150px;
            overflow-y: auto;
            display: none;
        }

        .address-suggestion {
            padding: 8px 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .address-suggestion:hover {
            background-color: #f0f8ff;
        }

        .industry-selector {
            width: 80%;
            max-width: 300px;
            margin: 0 auto 12px;
        }

        .verification-container {
            text-align: center;
            margin: 12px auto;
            max-width: 300px;
        }

        .verification-code {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
        }

        .verification-code input {
            width: 40px;
            height: 40px;
            text-align: center;
            font-size: 18px;
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            margin-bottom: 0;
        }

        .verification-timer {
            font-size: 12px;
            margin-top: 8px;
            color: var(--primary-dark);
        }

        .resend-code {
            font-size: 12px;
            color: var(--primary-color);
            text-decoration: underline;
            cursor: pointer;
            margin-top: 4px;
            display: none;
        }

        .multi-step-container {
            position: relative;
        }

        .step-progress {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .step-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #ddd;
            margin: 0 4px;
            transition: background-color 0.3s;
        }

        .step-indicator.active {
            background-color: var(--primary-color);
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .step-buttons {
            display: flex;
            justify-content: space-between;
            width: 80%;
            max-width: 300px;
            margin: 20px auto 0;
        }

        .prev-step-btn {
            background-color: #f0f0f0;
            color: var(--text-color);
            border: 1px solid #ddd;
        }

        .success-animation {
            text-align: center;
            margin: 20px auto;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--success-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            animation: scaleIn 0.5s ease;
        }

        .success-icon i {
            color: white;
            font-size: 40px;
        }

        .redirect-countdown {
            margin-top: 12px;
            font-size: 14px;
            color: var(--primary-dark);
        }

        .reset-password-container {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .go-back {
            font-size: 12px;
            color: var(--primary-color);
            cursor: pointer;
            margin-top: 12px;
            display: inline-block;
            border: 1px solid var(--primary-color);
            padding: 8px 12px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .go-back:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .reset-email-text {
            margin: 20px 0 15px 0;
            font-size: 14px;
            color: var(--text-color);
        }

        /* Splash screen animation styles */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .dots-container {
            width: 80%;
            max-width: 300px;
            height: 60px;
            position: relative;
            margin-bottom: 30px;
        }

        .moving-dot {
            width: 20px;
            height: 20px;
            background-color: var(--primary-color);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }

        #leftDot {
            left: 0;
            animation: moveLeftDot 2s infinite ease-in-out;
        }

        #rightDot {
            right: 0;
            animation: moveRightDot 2s infinite ease-in-out;
        }

        .slogan {
            font-family: 'Billabong', cursive;
            color: var(--primary-dark);
            font-size: 24px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeSlogan 3s forwards;
            text-align: center;
            padding: 0 20px;
        }

        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            animation: pulseImage 2s infinite alternate;
            margin-bottom: 20px;
        }

        /* Styles pour le prompt d'installation */
        #installPrompt {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--white);
            border: 1px solid var(--primary-color);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            width: 90%;
            max-width: 300px;
            text-align: center;
            animation: slideUpPrompt 0.5s ease;
        }

        @keyframes slideUpPrompt {
            from {
                transform: translate(-50%, 100%);
                opacity: 0;
            }

            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        .install-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 16px;
            margin-top: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .close-prompt {
            position: absolute;
            top: 8px;
            right: 12px;
            font-size: 18px;
            cursor: pointer;
            color: #999;
        }

        @keyframes dotPulse {

            0%,
            80%,
            100% {
                transform: scale(0);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
            }

            to {
                transform: scale(1);
            }
        }

        @keyframes moveLeftDot {

            0%,
            100% {
                left: 0;
            }

            50% {
                left: calc(100% - 20px);
            }
        }

        @keyframes moveRightDot {

            0%,
            100% {
                right: 0;
            }

            50% {
                right: calc(100% - 20px);
            }
        }

        @keyframes fadeSlogan {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            50% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulseImage {
            from {
                transform: scale(1);
                box-shadow: 0 0 0 rgba(0, 123, 255, 0.4);
            }

            to {
                transform: scale(1.05);
                box-shadow: 0 0 15px rgba(0, 123, 255, 0.7);
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 1.8em;
            }

            .form-container {
                margin: 12px;
                padding: 16px;
            }

            .button {
                width: 90%;
            }

            .form-container input,
            .form-container select,
            .form-container textarea {
                width: 90%;
                max-height: 40px;
                /* Prevent enlargement on iPhone */
                font-size: 16px;
                /* Font size that avoids automatic zoom on iOS */
            }

            h2 {
                font-size: 26px;
            }

            .phone-input-container {
                width: 90%;
            }

            .industry-selector {
                width: 90%;
            }

            .splash-screen .slogan {
                font-size: 20px;
            }

            .profile-image {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>

<body>
    <!-- Stylized splash screen -->
    <div class="splash-screen" id="splashScreen">
        <img src="https://firebasestorage.googleapis.com/v0/b/monetizelt-b235d.firebasestorage.app/o/1000009017_resized.jpg?alt=media&token=d69084a3-b285-44e4-81a5-f05971314175"
            alt="Monetizelt" class="profile-image">
        <div class="dots-container">
            <div class="moving-dot" id="leftDot"></div>
            <div class="moving-dot" id="rightDot"></div>
        </div>
        <div class="slogan"></div>
    </div>

    <div class="progress-bar" id="progressBar"></div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
    </div>

    <header>
        <span class="logo" translate="no"><b>Monetizelt</b></span>
    </header>
    <div class="divider"></div>

    <!-- Prompt d'installation (caché par défaut) -->
    <div id="installPrompt">
        <span class="close-prompt" id="closePrompt">&times;</span>
        <p>Installez Monetizelt sur votre appareil pour un accès rapide</p>
        <button class="install-btn" id="installApp">Installer</button>
    </div>

    <div class="form-container" id="loginForm">
        <h2><b>Welcome Back</b></h2>
        <div id="loginMessages"></div>
        <input type="email" id="loginEmail" placeholder="Enter your email" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button class="button" id="loginUser">
            <div class="loading-dots hidden" id="loginDots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            Login
        </button>
        <p class="toggle-button" id="showSignup"><b>No account? Sign up</b></p>
        <p class="forgot-password" id="forgotPassword"><b>Forgot password?</b></p>
        <div class="footer-links">
            <a href="terms.html">Terms of Use</a> |
            <a href="privacy.html">Privacy Policy</a>
        </div>
    </div>

    <div class="form-container reset-password-container" id="resetPasswordForm">
        <h2><b>Reset Password</b></h2>
        <div id="resetPasswordMessages"></div>
        <div class="reset-email-text">Enter your email address</div>
        <input type="email" id="resetEmail" placeholder="Enter your email" required>
        <button class="button" id="sendResetEmail">
            <div class="loading-dots hidden" id="resetCodeDots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            Send Reset Link
        </button>
        <p class="go-back" id="backToLogin"><b>Back to login</b></p>
        <div class="footer-links">
            <a href="terms.html">Terms of Use</a> |
            <a href="privacy.html">Privacy Policy</a>
        </div>
    </div>

    <div class="form-container" id="signupForm" style="display: none;">
        <h2><b>Welcome</b></h2>
        <div id="signupMessages"></div>

        <div class="multi-step-container">
            <div class="step-progress">
                <div class="step-indicator active" data-step="1"></div>
                <div class="step-indicator" data-step="2"></div>
                <div class="step-indicator" data-step="3"></div>
            </div>

            <div class="account-type-selector">
                <button class="account-type-btn active" id="individualBtn">Individual</button>
                <button class="account-type-btn" id="businessBtn">Business</button>
            </div>

            <!-- Step 1: Basic Information -->
            <div class="form-step active" id="step1">
                <div class="form-section">
                    <div class="form-section-title">Account Information</div>
                    <input type="text" id="fullName" placeholder="Full name" required>
                    <select id="signupCountry" required>
                        <option value="" disabled selected>Select your country</option>
                    </select>
                    <div class="date-label">Select your birth date</div>
                    <input type="date" id="birthdate" required>
                    <input type="email" id="signupEmail" placeholder="Enter your email" required>
                    <input type="password" id="signupPassword" placeholder="Create a password" required>
                    <div class="password-strength">
                        <div class="password-strength-meter" id="passwordStrengthMeter"></div>
                    </div>
                    <div class="password-feedback" id="passwordFeedback"></div>
                    <input type="password" id="confirmPassword" placeholder="Confirm password" required>
                </div>

                <div class="step-buttons">
                    <button class="button" id="goToStep2">Continue</button>
                </div>
            </div>

            <!-- Step 2: Contact Information -->
            <div class="form-step" id="step2">
                <div class="field-group active" id="individualFields">
                    <div class="form-section">
                        <div class="form-section-title">Personal Information</div>
                        <div class="phone-input-container">
                            <select class="phone-prefix" id="individualPhonePrefix">
                                <!-- Will be populated with JavaScript -->
                            </select>
                            <input type="tel" class="phone-number" id="individualPhone" placeholder="Phone number"
                                required maxlength="15">
                        </div>
                        <div class="input-feedback" id="individualPhoneFeedback"></div>

                        <input type="text" id="individualAddressLine1" placeholder="Address Line 1" required>
                        <div class="address-suggestions" id="individualAddressSuggestions"></div>
                        <input type="text" id="individualAddressLine2" placeholder="Address Line 2 (optional)">
                        <input type="text" id="individualCity" placeholder="City" required>
                        <input type="text" id="individualPostalCode" placeholder="Postal/ZIP Code" required>
                        <select id="individualOccupation" required>
                            <option value="" disabled selected>Select your occupation</option>
                            <option value="student">Student</option>
                            <option value="employed">Employed</option>
                            <option value="self-employed">Self-employed</option>
                            <option value="freelancer">Freelancer</option>
                            <option value="unemployed">Unemployed</option>
                            <option value="retired">Retired</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="field-group" id="businessFields">
                    <div class="form-section">
                        <div class="form-section-title">Business Information</div>
                        <input type="text" id="companyName" placeholder="Company name" required>
                        <input type="text" id="businessRegistrationNumber" placeholder="Business registration number"
                            required maxlength="20">
                        <select id="businessIndustry" class="industry-selector" required>
                            <option value="" disabled selected>Select your industry</option>
                            <option value="technology">Technology</option>
                            <option value="finance">Finance</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="education">Education</option>
                            <option value="retail">Retail</option>
                            <option value="manufacturing">Manufacturing</option>
                            <option value="services">Professional Services</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="hospitality">E-commerce</option>
                            <option value="transportation">Transportation</option>
                            <option value="construction">Construction</option>
                            <option value="agriculture">Agriculture</option>
                            <option value="energy">Energy</option>
                            <option value="other">Other</option>
                        </select>

                        <select id="companySize" required>
                            <option value="" disabled selected>Company size</option>
                            <option value="1-10">1-10 employees</option>
                            <option value="11-50">11-50 employees</option>
                            <option value="51-200">51-200 employees</option>
                            <option value="201-500">201-500 employees</option>
                            <option value="500+">500+ employees</option>
                        </select>

                        <div class="phone-input-container">
                            <select class="phone-prefix" id="businessPhonePrefix">
                                <!-- Will be populated with JavaScript -->
                            </select>
                            <input type="tel" class="phone-number" id="businessPhone" placeholder="Business phone"
                                required maxlength="15">
                        </div>
                        <div class="input-feedback" id="businessPhoneFeedback"></div>

                        <input type="text" id="businessAddressLine1" placeholder="Business address line 1" required>
                        <div class="address-suggestions" id="businessAddressSuggestions"></div>
                        <input type="text" id="businessAddressLine2" placeholder="Business address line 2 (optional)">
                        <input type="text" id="businessCity" placeholder="City" required>
                        <input type="text" id="businessPostalCode" placeholder="Postal/ZIP Code" required>
                        <input type="text" id="businessWebsite" placeholder="Business website (optional)">
                    </div>
                </div>

                <div class="step-buttons">
                    <button class="button prev-step-btn" id="backToStep1">Back</button>
                    <button class="button" id="goToStep3">Continue</button>
                </div>
            </div>

            <!-- Step 3: Verification -->
            <div class="form-step" id="step3">
                <div class="form-section">
                    <div class="form-section-title">Email Verification</div>
                    <div class="verification-container">
                        <p>A verification code has been sent to your email.</p>
                        <div class="verification-code">
                            <input type="text" maxlength="1" class="code-digit" id="digit1">
                            <input type="text" maxlength="1" class="code-digit" id="digit2">
                            <input type="text" maxlength="1" class="code-digit" id="digit3">
                            <input type="text" maxlength="1" class="code-digit" id="digit4">
                            <input type="text" maxlength="1" class="code-digit" id="digit5">
                            <input type="text" maxlength="1" class="code-digit" id="digit6">
                        </div>
                        <div class="verification-timer" id="verificationTimer">Resend code in 00:59</div>
                        <div class="resend-code" id="resendCode">Resend verification code</div>
                    </div>
                </div>

                <div class="step-buttons">
                    <button class="button prev-step-btn" id="backToStep2">Back</button>
                    <button class="button" id="createAccount">
                        <div class="loading-dots hidden" id="signupDots">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                        Create Account
                    </button>
                </div>
            </div>

            <!-- Success Step -->
            <div class="form-step" id="successStep">
                <div class="success-animation">
                    <div class="success-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <h3>Account Created Successfully!</h3>
                    <p>Welcome to Monetizelt. Your account has been created.</p>
                    <div class="redirect-countdown" id="redirectCountdown">Redirecting in 1 second...</div>
                </div>
            </div>
        </div>

        <p class="toggle-button" id="showLogin"><b>Already have an account? Log in</b></p>
        <div class="footer-links">
            <a href="terms-.html">Terms of Use</a> |
            <a href="privacy-.html">Privacy Policy</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, updatePassword, onAuthStateChanged, sendEmailVerification } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAF4I7E6-_z8y_8n8P35zyKbh9WOEtIzMQ",
            authDomain: "monetizelt-b235d.firebaseapp.com",
            databaseURL: "https://monetizelt-b235d-default-rtdb.firebaseio.com",
            projectId: "monetizelt-b235d",
            storageBucket: "monetizelt-b235d.firebasestorage.app",
            messagingSenderId: "1040211471009",
            appId: "1:1040211471009:web:321898c7bdca6258ce9ee0",
            measurementId: "G-5NWKR1E9VY"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global variables for splash screen
        const splashScreen = document.getElementById('splashScreen');
        let deferredPrompt;

        // Install prompt elements
        const installPrompt = document.getElementById('installPrompt');
        const closePromptBtn = document.getElementById('closePrompt');
        const installAppBtn = document.getElementById('installApp');

        const progressBar = document.getElementById('progressBar');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loginMessages = document.getElementById('loginMessages');
        const signupMessages = document.getElementById('signupMessages');
        const resetPasswordMessages = document.getElementById('resetPasswordMessages');
        const loginDots = document.getElementById('loginDots');
        const signupDots = document.getElementById('signupDots');
        const resetCodeDots = document.getElementById('resetCodeDots');
        const countrySelect = document.getElementById('signupCountry');
        const individualBtn = document.getElementById('individualBtn');
        const businessBtn = document.getElementById('businessBtn');
        const individualFields = document.getElementById('individualFields');
        const businessFields = document.getElementById('businessFields');
        const individualPhonePrefix = document.getElementById('individualPhonePrefix');
        const businessPhonePrefix = document.getElementById('businessPhonePrefix');
        const individualPhoneFeedback = document.getElementById('individualPhoneFeedback');
        const businessPhoneFeedback = document.getElementById('businessPhoneFeedback');
        const individualAddressSuggestions = document.getElementById('individualAddressSuggestions');
        const businessAddressSuggestions = document.getElementById('businessAddressSuggestions');
        const individualPhone = document.getElementById('individualPhone');
        const businessPhone = document.getElementById('businessPhone');
        const businessRegistrationNumber = document.getElementById('businessRegistrationNumber');
        const loginForm = document.getElementById('loginForm');
        const resetPasswordForm = document.getElementById('resetPasswordForm');
        const signupForm = document.getElementById('signupForm');

        // Multi-step form elements
        const steps = document.querySelectorAll('.form-step');
        const stepIndicators = document.querySelectorAll('.step-indicator');
        const goToStep2Btn = document.getElementById('goToStep2');
        const goToStep3Btn = document.getElementById('goToStep3');
        const backToStep1Btn = document.getElementById('backToStep1');
        const backToStep2Btn = document.getElementById('backToStep2');
        const createAccountBtn = document.getElementById('createAccount');
        const redirectCountdown = document.getElementById('redirectCountdown');

        // Verification elements
        const verificationTimer = document.getElementById('verificationTimer');
        const resendCode = document.getElementById('resendCode');
        const codeDigits = document.querySelectorAll('#step3 .code-digit');

        let currentAccountType = 'individual';
        let countriesLoaded = false;
        let redirectionActive = false;
        let currentStep = 1;
        let countryPhoneCodes = {};
        let verificationTimerInterval;
        let verificationSecondsLeft = 59;
        let addressAutocompleteTimeout;
        let phoneMaxLengths = {};
        let businessRegNumberFormats = {};
        let verificationCode = "";

        // Splash screen animation
        function handleSplashScreen() {
            // Display splash screen for 3.5 seconds
            setTimeout(() => {
                splashScreen.classList.add('hidden');
                // Remove completely after transition ends
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                }, 500);
            }, 1500);
        }

        // Function to handle PWA installation
        function handlePWAInstallation() {
            // Écouter l'événement beforeinstallprompt, qui est déclenché quand l'application 
            // peut être installée (et pas automatiquement par le navigateur)
            window.addEventListener('beforeinstallprompt', (e) => {
                // Empêcher Chrome 67+ d'afficher automatiquement le prompt d'installation
                e.preventDefault();
                // Sauvegarder l'événement pour pouvoir le déclencher plus tard
                deferredPrompt = e;

                // Ne pas afficher automatiquement le prompt d'installation
                // L'utilisateur doit utiliser le bouton de partage/menu pour trouver l'option
                console.log('L\'application peut être installée');

                // Option: si vous voulez afficher votre propre UI après quelques minutes
                // setTimeout(() => {
                //     if (deferredPrompt) {
                //         installPrompt.style.display = 'block';
                //     }
                // }, 5 * 60 * 1000); // 5 minutes
            });

            // Événements pour fermer le prompt d'installation personnalisé
            closePromptBtn.addEventListener('click', () => {
                installPrompt.style.display = 'none';
            });

            // Événement pour le bouton d'installation personnalisé
            installAppBtn.addEventListener('click', async () => {
                if (!deferredPrompt) {
                    return;
                }

                // Afficher le prompt d'installation du navigateur
                deferredPrompt.prompt();

                // Attendre la décision de l'utilisateur
                const choiceResult = await deferredPrompt.userChoice;

                // Que l'utilisateur accepte ou refuse, on cache le prompt
                installPrompt.style.display = 'none';

                // On ne peut utiliser le prompt qu'une seule fois
                deferredPrompt = null;
            });

            // Écouter l'événement quand l'app a été installée
            window.addEventListener('appinstalled', () => {
                console.log('Application installée avec succès');
                // Cacher le prompt d'installation personnalisé
                installPrompt.style.display = 'none';
                deferredPrompt = null;
            });
        }

        // Function to generate a unique 6-character user ID
        function generateUserId() {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            let result = '';

            // Ensure there are at least 3 letters and 3 numbers
            const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            const numbers = "0123456789";

            // Add 3 random letters
            for (let i = 0; i < 3; i++) {
                result += letters.charAt(Math.floor(Math.random() * letters.length));
            }

            // Add 3 random numbers
            for (let i = 0; i < 3; i++) {
                result += numbers.charAt(Math.floor(Math.random() * numbers.length));
            }

            // Shuffle characters to get a less predictable ID
            return result.split('').sort(() => 0.5 - Math.random()).join('');
        }

        // Function to check if a userId already exists
        async function isUserIdUnique(userId) {
            try {
                const userSnapshot = await getDoc(doc(db, "users", `userId_${userId}`));
                return !userSnapshot.exists();
            } catch (error) {
                console.error("Error checking userId uniqueness:", error);
                return false;
            }
        }

        // Function to generate a unique userId
        async function generateUniqueUserId() {
            let userId;
            let isUnique = false;
            let attempts = 0;

            // Try until finding a unique ID (maximum 10 attempts)
            while (!isUnique && attempts < 10) {
                userId = generateUserId();
                isUnique = await isUserIdUnique(userId);
                attempts++;
            }

            return userId;
        }

        // Function to generate a 6-digit PIN code
        function generateVerificationCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // Function to send verification code via email using SendGrid
        async function sendVerificationEmail(email, code) {
            try {
                // In production, call your Cloud function to send the email
                const endpoint = 'https://us-central1-monetizelt-b235d.cloudfunctions.net/sendVerificationCode';

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        code: code
                    }),
                });

                const data = await response.json();
                return data.success;
            } catch (error) {
                console.error(`Error sending verification email:`, error);
                return false;
            }
        }

        function showMessage(container, message, type = 'error') {
            const iconClass = type === 'error' ? 'fa-circle-exclamation' :
                type === 'success' ? 'fa-circle-check' :
                    type === 'warning' ? 'fa-triangle-exclamation' : 'fa-circle-info';

            container.innerHTML = `
                <div class="message ${type}">
                    <i class="fas ${iconClass}"></i>
                    ${message}
                </div>
            `;
        }

        function simulateProgress(start, end, duration) {
            const startTime = Date.now();
            progressBar.style.width = start + '%';

            function updateProgress() {
                const currentTime = Date.now();
                const elapsed = currentTime - startTime;
                const progress = Math.min((elapsed / duration) * (end - start) + start, end);

                progressBar.style.width = progress + '%';

                if (progress < end) {
                    requestAnimationFrame(updateProgress);
                } else if (end === 100) {
                    setTimeout(() => {
                        progressBar.style.width = '0%';
                    }, 300);
                }
            }

            requestAnimationFrame(updateProgress);
        }

        function toggleLoader(show) {
            if (show) {
                loadingOverlay.classList.add('active');
            } else {
                loadingOverlay.classList.remove('active');
            }
        }

        function setBtnLoading(button, dots, isLoading) {
            if (isLoading) {
                button.disabled = true;
                dots.classList.remove('hidden');
            } else {
                button.disabled = false;
                dots.classList.add('hidden');
            }
        }

        // Function for smooth transition between individual and business
        function switchAccountType(type) {
            if (type === currentAccountType) return;

            // Save data from the old type
            const oldFields = currentAccountType === 'individual' ? individualFields : businessFields;
            const newFields = type === 'individual' ? individualFields : businessFields;

            // Animation for the old section
            oldFields.style.opacity = '1';
            let fadeOut = oldFields.animate([
                { opacity: 1 },
                { opacity: 0 }
            ], {
                duration: 300,
                easing: 'ease-out',
                fill: 'forwards'
            });

            fadeOut.onfinish = () => {
                // Hide old section and show new one
                oldFields.classList.remove('active');
                newFields.classList.add('active');

                // Animation for new section
                newFields.style.opacity = '0';
                newFields.animate([
                    { opacity: 0 },
                    { opacity: 1 }
                ], {
                    duration: 300,
                    easing: 'ease-in',
                    fill: 'forwards'
                });

                // Update current account type
                currentAccountType = type;
            };
        }

        // Function to switch between forms (login, signup, reset password)
        function switchForm(showFormId) {
            // Hide all forms
            loginForm.style.display = 'none';
            signupForm.style.display = 'none';
            resetPasswordForm.style.display = 'none';

            // Show requested form
            document.getElementById(showFormId).style.display = 'block';

            // Reset messages
            loginMessages.innerHTML = '';
            signupMessages.innerHTML = '';
            resetPasswordMessages.innerHTML = '';
        }

        // Multi-step form navigation
        function goToStep(step) {
            steps.forEach(s => s.classList.remove('active'));
            stepIndicators.forEach(ind => {
                if (parseInt(ind.dataset.step) <= step) {
                    ind.classList.add('active');
                } else {
                    ind.classList.remove('active');
                }
            });

            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;

            // Reset signup messages when changing steps
            signupMessages.innerHTML = '';
        }

        function showSuccessStep() {
            steps.forEach(s => s.classList.remove('active'));
            document.getElementById('successStep').classList.add('active');

            // Start countdown for redirection
            let secondsLeft = 1;
            const countdownInterval = setInterval(() => {
                secondsLeft--;
                redirectCountdown.textContent = `Redirecting in ${secondsLeft} second${secondsLeft !== 1 ? 's' : ''}...`;

                if (secondsLeft <= 0) {
                    clearInterval(countdownInterval);
                    toggleLoader(true);
                    window.location.href = "dashboard.html";
                }
            }, 1000);
        }

        // Email verification UI
        function startVerificationTimer() {
            verificationSecondsLeft = 59;
            resendCode.style.display = 'none';
            verificationTimer.style.display = 'block';

            clearInterval(verificationTimerInterval);
            verificationTimerInterval = setInterval(() => {
                verificationSecondsLeft--;
                verificationTimer.textContent = `Resend code in 00:${verificationSecondsLeft < 10 ? '0' + verificationSecondsLeft : verificationSecondsLeft}`;

                if (verificationSecondsLeft <= 0) {
                    clearInterval(verificationTimerInterval);
                    verificationTimer.style.display = 'none';
                    resendCode.style.display = 'block';
                }
            }, 1000);
        }

        // Send verification code via email
        async function sendEmailVerificationCode(email) {
            // Generate a new verification code
            verificationCode = generateVerificationCode();
            console.log(`Verification code for ${email}: ${verificationCode}`);

            // Reset code fields
            codeDigits.forEach(digit => digit.value = '');

            // Start timer
            startVerificationTimer();

            // Send code via email using SendGrid
            try {
                showMessage(signupMessages, "Sending verification code...", "info");
                const success = await sendVerificationEmail(email, verificationCode);

                if (success) {
                    showMessage(signupMessages, "Verification code sent to your email", "success");
                } else {
                    showMessage(signupMessages, "Failed to send verification code. Please try again.", "error");
                }
            } catch (error) {
                console.error("Error sending verification email:", error);
                showMessage(signupMessages, "Failed to send verification code. Please try again.", "error");
            }

            return verificationCode;
        }

        // Password strength evaluation function
        function evaluatePasswordStrength(password, meterElementId, feedbackElementId) {
            const meter = document.getElementById(meterElementId);
            const feedback = document.getElementById(feedbackElementId);

            if (!password) {
                meter.style.width = '0%';
                feedback.textContent = '';
                return;
            }

            let strength = 0;
            let message = '';

            if (password.length > 5) strength += 20;
            if (password.length > 8) strength += 10;

            if (/[a-z]/.test(password)) strength += 10;
            if (/[A-Z]/.test(password)) strength += 15;
            if (/[0-9]/.test(password)) strength += 15;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 20;

            let color;
            if (strength < 30) {
                color = '#ff4d4d';
                message = 'Very weak password';
            } else if (strength < 50) {
                color = '#ffaa00';
                message = 'Weak password';
            } else if (strength < 70) {
                color = '#ffdd00';
                message = 'Medium password';
            } else if (strength < 90) {
                color = '#4CAF50';
                message = 'Strong password';
            } else {
                color = '#4CAF50';
                message = 'Very strong password';
            }

            meter.style.width = strength + '%';
            meter.style.backgroundColor = color;
            feedback.textContent = message;
            feedback.style.color = color;
        }

        individualBtn.addEventListener('click', function () {
            individualBtn.classList.add('active');
            businessBtn.classList.remove('active');
            switchAccountType('individual');
        });

        businessBtn.addEventListener('click', function () {
            businessBtn.classList.add('active');
            individualBtn.classList.remove('active');
            switchAccountType('business');
        });

        // Set maximum lengths for phone numbers by country
        function setPhoneMaxLengths() {
            phoneMaxLengths = {
                '+1': 10, // USA/Canada
                '+44': 11, // UK
                '+33': 9, // France
                '+49': 11, // Germany
                '+61': 9, // Australia
                '+86': 11, // China
                '+81': 10, // Japan
                '+34': 9, // Spain
                '+39': 10, // Italy
                '+55': 11, // Brazil
                '+91': 10, // India
                '+52': 10, // Mexico
                '+7': 10, // Russia
                '+65': 8, // Singapore
                '+971': 9, // UAE
                // Add other countries as needed
            };

            // Default value for other countries
            phoneMaxLengths['default'] = 15;
        }

        // Set formats and rules for business registration numbers by country
        function setBusinessRegNumberFormats() {
            businessRegNumberFormats = {
                // Format: [validation regex, maxLength]
                'United States': [/^[0-9]{2}-[0-9]{7}$|^[0-9]{9}$/, 10], // EIN format XX-XXXXXXX or XXXXXXXXX
                'United Kingdom': [/^[0-9]{8}$/, 8], // Company number format
                'France': [/^[0-9]{9}$/, 9], // SIREN format
                'Germany': [/^[A-Z]{2}[0-9]{6}$|^[0-9]{9}$/, 9], // Handelsregister format
                'Australia': [/^[0-9]{9}$/, 9], // ABN format
                'Canada': [/^[0-9]{9}$|^[0-9]{15}$/, 15], // Business Number or Corporation Number
                // Default: accept digits, letters, dashes, and spaces
                'default': [/^[A-Za-z0-9\-\s]{1,20}$/, 20]
            };
        }

        // Phone number validation
        function validatePhoneNumber(phoneNumber, countryCode) {
            // Remove spaces, dashes, and parentheses
            const cleanedNumber = phoneNumber.replace(/[\s\-()]/g, '');

            // Simple validation based on length and digits
            if (!/^\d+$/.test(cleanedNumber)) {
                return { valid: false, message: "Phone number should contain only digits" };
            }

            // Check length according to country
            // This is a very basic validation - in production, you would use a library like libphonenumber-js
            const numberLengths = {
                '+1': { min: 10, max: 10 }, // US/Canada
                '+44': { min: 10, max: 11 }, // UK
                '+33': { min: 9, max: 9 }, // France
                '+49': { min: 10, max: 11 }, // Germany
                '+61': { min: 9, max: 9 }, // Australia
                // Add other countries as needed
            };

            if (numberLengths[countryCode]) {
                const { min, max } = numberLengths[countryCode];
                if (cleanedNumber.length < min || cleanedNumber.length > max) {
                    return {
                        valid: false,
                        message: `Phone number should be between ${min} and ${max} digits for this country code`
                    };
                }
            } else if (cleanedNumber.length < 7 || cleanedNumber.length > 15) {
                // General validation for other countries
                return { valid: false, message: "Phone number length is invalid" };
            }

            return { valid: true, message: "Valid phone number" };
        }

        // Business registration number validation
        function validateBusinessRegistrationNumber(number, country) {
            // Get format for selected country or default format
            const [regex, maxLength] = businessRegNumberFormats[country] || businessRegNumberFormats['default'];

            // Clean number (remove extra spaces)
            const cleanedNumber = number.trim();

            // Check maximum length
            if (cleanedNumber.length > maxLength) {
                return {
                    valid: false,
                    message: `Business registration number should be maximum ${maxLength} characters for ${country}`
                };
            }

            // Check format with regex
            if (!regex.test(cleanedNumber)) {
                // Country-specific error message
                let message;
                if (country === 'United States') {
                    message = "US EIN should be in format XX-XXXXXXX or XXXXXXXXX";
                } else if (country === 'United Kingdom') {
                    message = "UK Company number should be 8 digits";
                } else if (country === 'France') {
                    message = "SIREN should be 9 digits";
                } else {
                    message = "Invalid business registration number format";
                }
                return { valid: false, message };
            }

            return { valid: true, message: "Valid business registration number" };
        }

        // Business registration number formatting function
        function formatBusinessRegistrationNumber(input, country) {
            let value = input.value.replace(/\s+/g, ''); // Remove all spaces

            // Country-specific formatting
            if (country === 'United States') {
                // EIN format: XX-XXXXXXX
                if (value.length > 2 && !value.includes('-')) {
                    value = value.substring(0, 2) + '-' + value.substring(2);
                }
            } else if (country === 'Canada') {
                // Business Number format: XXXXXXXXRM0000
                if (value.length > 9 && !value.includes(' ')) {
                    value = value.substring(0, 9) + ' ' + value.substring(9);
                }
            }

            // Limit to maximum length
            const [_, maxLength] = businessRegNumberFormats[country] || businessRegNumberFormats['default'];
            if (value.length > maxLength) {
                value = value.substring(0, maxLength);
            }

            input.value = value;
        }

        // Phone number validation and formatting
        function handlePhoneInput(inputElement, feedbackElement, prefixElement) {
            const phoneNumber = inputElement.value.trim();
            const countryCode = prefixElement.value;

            // Limit number length based on country
            const maxLength = phoneMaxLengths[countryCode] || phoneMaxLengths['default'];

            // Remove non-numeric characters
            const cleanedNumber = phoneNumber.replace(/\D/g, '');

            // If cleaned number is longer than maximum allowed, truncate it
            if (cleanedNumber.length > maxLength) {
                inputElement.value = cleanedNumber.substring(0, maxLength);
            } else {
                // Otherwise, update with cleaned number
                inputElement.value = cleanedNumber;
            }

            const result = validatePhoneNumber(inputElement.value, countryCode);

            if (result.valid) {
                feedbackElement.textContent = "✓ Valid phone number";
                feedbackElement.style.color = "var(--success-color)";
                inputElement.style.borderColor = "var(--success-color)";
            } else {
                feedbackElement.textContent = result.message;
                feedbackElement.style.color = "var(--error-color)";
                inputElement.style.borderColor = "var(--error-color)";
            }
        }

        // Business registration number handling
        function handleBusinessRegistrationInput() {
            const country = document.getElementById('signupCountry').value;
            formatBusinessRegistrationNumber(businessRegistrationNumber, country);

            // Could add visual feedback here like for phone if needed
        }

        // Function to set up phone field listeners
        function setupPhoneListeners() {
            // Individual phone prefix change listener
            individualPhonePrefix.addEventListener('change', function () {
                // Reset phone field when prefix changes
                individualPhone.value = '';
                individualPhoneFeedback.textContent = '';
                individualPhone.style.borderColor = "var(--primary-color)";

                // Update character limit
                const countryCode = this.value;
                const maxLength = phoneMaxLengths[countryCode] || phoneMaxLengths['default'];
                individualPhone.setAttribute('maxlength', maxLength);
            });

            // Business phone prefix change listener
            businessPhonePrefix.addEventListener('change', function () {
                // Reset phone field when prefix changes
                businessPhone.value = '';
                businessPhoneFeedback.textContent = '';
                businessPhone.style.borderColor = "var(--primary-color)";

                // Update character limit
                const countryCode = this.value;
                const maxLength = phoneMaxLengths[countryCode] || phoneMaxLengths['default'];
                businessPhone.setAttribute('maxlength', maxLength);
            });

            // Individual phone input listener
            individualPhone.addEventListener('input', function () {
                handlePhoneInput(this, individualPhoneFeedback, individualPhonePrefix);
            });

            // Business phone input listener
            businessPhone.addEventListener('input', function () {
                handlePhoneInput(this, businessPhoneFeedback, businessPhonePrefix);
            });

            // Ensure only digits are allowed
            individualPhone.addEventListener('keypress', function (e) {
                if (!/\d/.test(e.key)) {
                    e.preventDefault();
                }
            });

            businessPhone.addEventListener('keypress', function (e) {
                if (!/\d/.test(e.key)) {
                    e.preventDefault();
                }
            });

            // Business registration number input listener
            businessRegistrationNumber.addEventListener('input', handleBusinessRegistrationInput);

            // Country change listener (to update business registration number format)
            document.getElementById('signupCountry').addEventListener('change', function () {
                const country = this.value;
                const [_, regMaxLength] = businessRegNumberFormats[country] || businessRegNumberFormats['default'];
                businessRegistrationNumber.setAttribute('maxlength', regMaxLength);

                if (businessRegistrationNumber.value) {
                    handleBusinessRegistrationInput();
                }
            });
        }

        // Verification code fields setup
        function setupVerificationCodeFields(codeInputs) {
            codeInputs.forEach((input, index) => {
                input.addEventListener('input', function () {
                    // Check that the value is a digit
                    if (!/^\d*$/.test(this.value)) {
                        this.value = this.value.replace(/\D/g, '');
                    }

                    if (this.value.length === 1) {
                        // Move to next field
                        if (index < codeInputs.length - 1) {
                            codeInputs[index + 1].focus();
                        }
                    }
                });

                input.addEventListener('keydown', function (e) {
                    if (e.key === 'Backspace' && !this.value) {
                        // Return to previous field if Backspace is pressed on empty field
                        if (index > 0) {
                            codeInputs[index - 1].focus();
                        }
                    }
                });

                // Accept only digits
                input.addEventListener('keypress', function (e) {
                    if (!/\d/.test(e.key)) {
                        e.preventDefault();
                    }
                });
            });
        }

        // Address autocomplete
        function initAddressAutocomplete(inputElement, suggestionsElement) {
            inputElement.addEventListener('input', function () {
                clearTimeout(addressAutocompleteTimeout);

                const query = this.value.trim();
                if (query.length < 3) {
                    suggestionsElement.style.display = 'none';
                    return;
                }

                // Delay to avoid too many requests
                addressAutocompleteTimeout = setTimeout(() => {
                    // Simulate address suggestions - in production, use a service like Google Places API, Mapbox, etc.
                    const fakeSuggestions = [
                        `${query}`,
                        `${query} Street`,
                        `${query} Avenue`
                    ];

                    // Display suggestions
                    suggestionsElement.innerHTML = '';
                    fakeSuggestions.forEach(suggestion => {
                        const div = document.createElement('div');
                        div.className = 'address-suggestion';
                        div.textContent = suggestion;
                        div.addEventListener('click', () => {
                            inputElement.value = suggestion;
                            suggestionsElement.style.display = 'none';
                        });
                        suggestionsElement.appendChild(div);
                    });

                    suggestionsElement.style.display = 'block';
                }, 300);
            });

            // Hide suggestions when user clicks elsewhere
            document.addEventListener('click', function (e) {
                if (e.target !== inputElement && !suggestionsElement.contains(e.target)) {
                    suggestionsElement.style.display = 'none';
                }
            });
        }

        async function loadCountriesAndPhoneCodes() {
            if (countriesLoaded) return;

            try {
                // Get list of countries with their phone codes
                const response = await fetch('https://restcountries.com/v3.1/all?fields=name,idd');

                if (!response.ok) {
                    throw new Error('Failed to load countries');
                }

                const countries = await response.json();

                // Sort countries by name
                countries.sort((a, b) => a.name.common.localeCompare(b.name.common));

                // Fill country selector
                populateCountrySelect(countries);

                // Fill phone prefixes
                populatePhonePrefixes(countries);

                countriesLoaded = true;
            } catch (error) {
                console.error("Error loading countries:", error);

                // Fallback data in case API fails
                const fallbackCountries = [
                    { name: { common: "United States" }, idd: { root: "+1", suffixes: [""] } },
                    { name: { common: "United Kingdom" }, idd: { root: "+44", suffixes: [""] } },
                    { name: { common: "Canada" }, idd: { root: "+1", suffixes: [""] } },
                    { name: { common: "Australia" }, idd: { root: "+61", suffixes: [""] } },
                    { name: { common: "Germany" }, idd: { root: "+49", suffixes: [""] } },
                    { name: { common: "France" }, idd: { root: "+33", suffixes: [""] } },
                    { name: { common: "Spain" }, idd: { root: "+34", suffixes: [""] } },
                    { name: { common: "Italy" }, idd: { root: "+39", suffixes: [""] } },
                    { name: { common: "Japan" }, idd: { root: "+81", suffixes: [""] } },
                    { name: { common: "China" }, idd: { root: "+86", suffixes: [""] } }
                ];

                populateCountrySelect(fallbackCountries);
                populatePhonePrefixes(fallbackCountries);
                countriesLoaded = true;
            }
        }

        function populateCountrySelect(countries) {
            countrySelect.innerHTML = '<option value="" disabled selected>Select your country</option>';

            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.name.common;
                option.textContent = country.name.common;
                countrySelect.appendChild(option);
            });
        }

        function populatePhonePrefixes(countries) {
            // Clear prefix selectors
            individualPhonePrefix.innerHTML = '';
            businessPhonePrefix.innerHTML = '';

            // Create object to store country codes
            countryPhoneCodes = {};

            countries.forEach(country => {
                // Check if country has a phone code
                if (country.idd && country.idd.root) {
                    const countryName = country.name.common;
                    const root = country.idd.root;

                    // If country has multiple suffixes, create an entry for each
                    if (country.idd.suffixes && country.idd.suffixes.length > 0) {
                        country.idd.suffixes.forEach(suffix => {
                            const fullCode = root + suffix;
                            countryPhoneCodes[countryName] = fullCode;

                            // Add option to both selectors
                            const option1 = document.createElement('option');
                            option1.value = fullCode;
                            option1.textContent = `${fullCode} (${countryName})`;
                            individualPhonePrefix.appendChild(option1);

                            const option2 = document.createElement('option');
                            option2.value = fullCode;
                            option2.textContent = `${fullCode} (${countryName})`;
                            businessPhonePrefix.appendChild(option2);
                        });
                    } else {
                        // If country has no suffixes, use only the root
                        countryPhoneCodes[countryName] = root;

                        const option1 = document.createElement('option');
                        option1.value = root;
                        option1.textContent = `${root} (${countryName})`;
                        individualPhonePrefix.appendChild(option1);

                        const option2 = document.createElement('option');
                        option2.value = root;
                        option2.textContent = `${root} (${countryName})`;
                        businessPhonePrefix.appendChild(option2);
                    }
                }
            });

            // Select +1 (US/Canada) by default
            individualPhonePrefix.value = '+1';
            businessPhonePrefix.value = '+1';

            // Initialize maximum lengths for phone number validation
            setPhoneMaxLengths();

            // Initialize business number formats
            setBusinessRegNumberFormats();

            // Update phone fields maxlength
            individualPhone.setAttribute('maxlength', phoneMaxLengths['+1']);
            businessPhone.setAttribute('maxlength', phoneMaxLengths['+1']);
        }

        // Function to get complete code from verification fields
        function getVerificationCode(codeInputs) {
            return Array.from(codeInputs).map(digit => digit.value).join('');
        }

        // Step navigation setup
        goToStep2Btn.addEventListener('click', function () {
            // Validate step 1 fields
            const fullName = document.getElementById("fullName").value.trim();
            const email = document.getElementById("signupEmail").value.trim();
            const password = document.getElementById("signupPassword").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            const country = document.getElementById("signupCountry").value;
            const birthdate = new Date(document.getElementById("birthdate").value);
            const today = new Date();

            if (!fullName) {
                showMessage(signupMessages, "Please enter your full name", "error");
                return;
            }
            if (!country) {
                showMessage(signupMessages, "Please select your country", "error");
                return;
            }
            if (!birthdate || isNaN(birthdate.getTime())) {
                showMessage(signupMessages, "Please enter a valid birth date", "error");
                return;
            }

            const age = today.getFullYear() - birthdate.getFullYear();
            const monthDiff = today.getMonth() - birthdate.getMonth();
            const adjustedAge = monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthdate.getDate()) ? age - 1 : age;

            if (adjustedAge < 18) {
                showMessage(signupMessages, "You must be at least 18 years old", "error");
                return;
            }

            if (!email) {
                showMessage(signupMessages, "Please enter your email address", "error");
                return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showMessage(signupMessages, "Please enter a valid email address", "error");
                return;
            }

            if (!password) {
                showMessage(signupMessages, "Please enter a password", "error");
                return;
            }

            if (password.length < 6) {
                showMessage(signupMessages, "Password must be at least 6 characters", "error");
                return;
            }

            if (password !== confirmPassword) {
                showMessage(signupMessages, "Passwords don't match", "error");
                return;
            }

            // If validation passes, go to step 2
            goToStep(2);

            // Update phone prefix based on selected country
            if (countryPhoneCodes[country]) {
                individualPhonePrefix.value = countryPhoneCodes[country];
                businessPhonePrefix.value = countryPhoneCodes[country];

                // Update phone fields maxlength
                const maxLength = phoneMaxLengths[countryPhoneCodes[country]] || phoneMaxLengths['default'];
                individualPhone.setAttribute('maxlength', maxLength);
                businessPhone.setAttribute('maxlength', maxLength);
            }

            // Update business registration number maxlength
            const [_, regMaxLength] = businessRegNumberFormats[country] || businessRegNumberFormats['default'];
            businessRegistrationNumber.setAttribute('maxlength', regMaxLength);
        });

        backToStep1Btn.addEventListener('click', function () {
            goToStep(1);
        });

        goToStep3Btn.addEventListener('click', function () {
            // Validate step 2 fields based on account type
            if (currentAccountType === 'individual') {
                const phone = document.getElementById("individualPhone").value.trim();
                const addressLine1 = document.getElementById("individualAddressLine1").value.trim();
                const city = document.getElementById("individualCity").value.trim();
                const postalCode = document.getElementById("individualPostalCode").value.trim();
                const occupation = document.getElementById("individualOccupation").value;

                if (!phone) {
                    showMessage(signupMessages, "Please enter your phone number", "error");
                    return;
                }

                // Validate phone number
                const phoneValidation = validatePhoneNumber(phone, individualPhonePrefix.value);
                if (!phoneValidation.valid) {
                    showMessage(signupMessages, phoneValidation.message, "error");
                    return;
                }

                if (!addressLine1) {
                    showMessage(signupMessages, "Please enter your address", "error");
                    return;
                }

                if (!city) {
                    showMessage(signupMessages, "Please enter your city", "error");
                    return;
                }

                if (!postalCode) {
                    showMessage(signupMessages, "Please enter your postal/ZIP code", "error");
                    return;
                }

                if (!occupation) {
                    showMessage(signupMessages, "Please select your occupation", "error");
                    return;
                }
            } else { // business
                const country = document.getElementById("signupCountry").value;
                const companyName = document.getElementById("companyName").value.trim();
                const registrationNumber = document.getElementById("businessRegistrationNumber").value.trim();
                const industry = document.getElementById("businessIndustry").value;
                const companySize = document.getElementById("companySize").value;
                const businessPhone = document.getElementById("businessPhone").value.trim();
                const addressLine1 = document.getElementById("businessAddressLine1").value.trim();
                const city = document.getElementById("businessCity").value.trim();
                const postalCode = document.getElementById("businessPostalCode").value.trim();

                if (!companyName) {
                    showMessage(signupMessages, "Please enter your company name", "error");
                    return;
                }

                if (!registrationNumber) {
                    showMessage(signupMessages, "Please enter business registration number", "error");
                    return;
                }

                // Validate business registration number
                const regValidation = validateBusinessRegistrationNumber(registrationNumber, country);
                if (!regValidation.valid) {
                    showMessage(signupMessages, regValidation.message, "error");
                    return;
                }

                if (!industry) {
                    showMessage(signupMessages, "Please select your industry", "error");
                    return;
                }

                if (!companySize) {
                    showMessage(signupMessages, "Please select your company size", "error");
                    return;
                }

                if (!businessPhone) {
                    showMessage(signupMessages, "Please enter business phone", "error");
                    return;
                }

                // Validate phone number
                const phoneValidation = validatePhoneNumber(businessPhone, businessPhonePrefix.value);
                if (!phoneValidation.valid) {
                    showMessage(signupMessages, phoneValidation.message, "error");
                    return;
                }

                if (!addressLine1) {
                    showMessage(signupMessages, "Please enter business address", "error");
                    return;
                }

                if (!city) {
                    showMessage(signupMessages, "Please enter your city", "error");
                    return;
                }

                if (!postalCode) {
                    showMessage(signupMessages, "Please enter your postal/ZIP code", "error");
                    return;
                }
            }

            // If validation passes, go to step 3
            goToStep(3);

            // Send verification code to email
            const email = document.getElementById("signupEmail").value.trim();
            sendEmailVerificationCode(email);
        });

        backToStep2Btn.addEventListener('click', function () {
            goToStep(2);
        });

        function init() {
            // Display splash screen
            handleSplashScreen();

            // Initialize PWA installation handling
            handlePWAInstallation();

            const today = new Date();
            const maxDate = today.toISOString().split('T')[0];
            document.getElementById('birthdate').setAttribute('max', maxDate);

            loadCountriesAndPhoneCodes();

            // Set up event listeners for phone numbers
            setupPhoneListeners();

            // Initialize address autocomplete
            initAddressAutocomplete(document.getElementById('individualAddressLine1'), individualAddressSuggestions);
            initAddressAutocomplete(document.getElementById('businessAddressLine1'), businessAddressSuggestions);

            // Set up verification code fields for registration
            setupVerificationCodeFields(codeDigits);

            // Add listeners for password strength evaluation
            document.getElementById('signupPassword').addEventListener('input', function () {
                evaluatePasswordStrength(this.value, 'passwordStrengthMeter', 'passwordFeedback');
            });

            // Check if user is already logged in
            onAuthStateChanged(auth, (user) => {
                if (user && !redirectionActive) {
                    checkUserProfileAndRedirect(user);
                }
            });

            // Listener for password reset link button
            document.getElementById('sendResetEmail').addEventListener('click', async function () {
                const email = document.getElementById('resetEmail').value.trim();

                if (!email) {
                    showMessage(resetPasswordMessages, "Please enter your email address", "error");
                    return;
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showMessage(resetPasswordMessages, "Please enter a valid email address", "error");
                    return;
                }

                setBtnLoading(this, resetCodeDots, true);
                simulateProgress(0, 50, 500);

                try {
                    await sendPasswordResetEmail(auth, email);
                    simulateProgress(50, 100, 300);
                    showMessage(resetPasswordMessages, "Password reset email sent. Please check your inbox to complete the process.", "success");

                    // Redirect to login page after 3 seconds
                    setTimeout(() => {
                        switchForm('loginForm');
                        showMessage(loginMessages, "Password reset email sent.", "success");
                        document.getElementById('loginEmail').value = email;
                    }, 3000);
                } catch (error) {
                    console.error("Error sending password reset email:", error);
                    simulateProgress(50, 100, 100);

                    if (error.code === 'auth/user-not-found') {
                        showMessage(resetPasswordMessages, "No account found with this email address", "error");
                    } else {
                        showMessage(resetPasswordMessages, "An error occurred. Please try again later.", "error");
                    }
                } finally {
                    setBtnLoading(this, resetCodeDots, false);
                }
            });

            // Listener for back to login button
            document.getElementById('backToLogin').addEventListener('click', function () {
                switchForm('loginForm');
            });
        }

        async function checkUserProfileAndRedirect(user) {
            try {
                redirectionActive = true; // Mark redirection as active from the start
                toggleLoader(true); // Show loader during verification

                const userDoc = await getDoc(doc(db, "users", user.uid));

                if (userDoc.exists()) {
                    window.location.href = "dashboard.html";
                } else {
                    // If profile doesn't exist yet, allow staying on the page
                    redirectionActive = false;
                    toggleLoader(false);
                }
            } catch (error) {
                console.error("Error checking user profile:", error);
                redirectionActive = false;
                toggleLoader(false);
            }
        }

        // Application initialization
        init();

        document.getElementById("createAccount").addEventListener("click", async function () {
            const createAccountBtn = this;
            setBtnLoading(createAccountBtn, signupDots, true);
            simulateProgress(0, 40, 300);

            // Get entered verification code
            const enteredCode = getVerificationCode(codeDigits);

            // Verify verification code
            if (enteredCode !== verificationCode) {
                showMessage(signupMessages, "Invalid verification code. Please check and try again.", "error");
                setBtnLoading(createAccountBtn, signupDots, false);
                simulateProgress(40, 100, 100);
                return;
            }

            // Get form information
            const fullName = document.getElementById("fullName").value.trim();
            const email = document.getElementById("signupEmail").value.trim();
            const password = document.getElementById("signupPassword").value;
            const country = document.getElementById("signupCountry").value;
            const birthdate = new Date(document.getElementById("birthdate").value);

            let userData = {
                fullName: fullName,
                email: email,
                country: country,
                birthdate: birthdate.toISOString().split('T')[0],
                accountType: currentAccountType,
                createdAt: serverTimestamp(),
                lastLogin: serverTimestamp(),
                products: [],
                linksCount: 0,
                viewsCount: 0,
                ordersCount: 0,
                shippedCount: 0,
                revenueCount: 0,
                onboardingComplete: false,
                transactions: [],
            };

            if (currentAccountType === 'individual') {
                const phonePrefix = document.getElementById("individualPhonePrefix").value;
                const phone = document.getElementById("individualPhone").value.trim();
                const addressLine1 = document.getElementById("individualAddressLine1").value.trim();
                const addressLine2 = document.getElementById("individualAddressLine2").value.trim();
                const city = document.getElementById("individualCity").value.trim();
                const postalCode = document.getElementById("individualPostalCode").value.trim();
                const occupation = document.getElementById("individualOccupation").value;

                // Build complete address
                const fullAddress = {
                    line1: addressLine1,
                    line2: addressLine2 || null,
                    city: city,
                    postalCode: postalCode,
                    country: country
                };

                // Add individual data to userData object
                userData = {
                    ...userData,
                    phonePrefix: phonePrefix,
                    phone: phone,
                    address: fullAddress,
                    occupation: occupation
                };
            } else { // business
                const companyName = document.getElementById("companyName").value.trim();
                const registrationNumber = document.getElementById("businessRegistrationNumber").value.trim();
                const industry = document.getElementById("businessIndustry").value;
                const companySize = document.getElementById("companySize").value;
                const phonePrefix = document.getElementById("businessPhonePrefix").value;
                const businessPhone = document.getElementById("businessPhone").value.trim();
                const addressLine1 = document.getElementById("businessAddressLine1").value.trim();
                const addressLine2 = document.getElementById("businessAddressLine2").value.trim();
                const city = document.getElementById("businessCity").value.trim();
                const postalCode = document.getElementById("businessPostalCode").value.trim();
                const website = document.getElementById("businessWebsite").value.trim();

                // Build complete business address
                const businessAddress = {
                    line1: addressLine1,
                    line2: addressLine2 || null,
                    city: city,
                    postalCode: postalCode,
                    country: country
                };

                // Add business data to userData object
                userData = {
                    ...userData,
                    companyName: companyName,
                    registrationNumber: registrationNumber,
                    industry: industry,
                    companySize: companySize,
                    phonePrefix: phonePrefix,
                    phone: businessPhone,
                    address: businessAddress,
                    website: website || null
                };
            }

            simulateProgress(40, 60, 300);

            try {
                showMessage(signupMessages, "Creating your account...", "info");

                // Create user account
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                simulateProgress(60, 80, 400);
                showMessage(signupMessages, "Generating your unique ID...", "info");

                // Generate unique user ID
                const userId = await generateUniqueUserId();

                if (!user || !user.uid) {
                    throw new Error("Failed to get user UID");
                }

                // Update user data with uid and userId
                userData = {
                    ...userData,
                    uid: user.uid,
                    userId: userId
                };

                // Save user data in users collection
                await setDoc(doc(db, "users", user.uid), userData);

                // Save user ID to check uniqueness
                await setDoc(doc(db, "users", `userId_${userId}`), {
                    uid: user.uid,
                    createdAt: serverTimestamp()
                });

                simulateProgress(80, 100, 300);

                // Show success animation
                showSuccessStep();

                // Set redirection as active to avoid double redirections
                redirectionActive = true;

            } catch (error) {
                let errorMessage = "Error creating account";

                if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email address format";
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = "Password should be at least 6 characters";
                } else if (error.code === 'auth/email-already-in-use') {
                    errorMessage = "This email is already associated with an account";
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = "Network error. Please check your internet connection";
                } else {
                    console.error("Signup error:", error);
                    errorMessage = "Error: " + (error.message || "Failed to create account. Please try again.");
                }

                showMessage(signupMessages, errorMessage, "error");
                setBtnLoading(createAccountBtn, signupDots, false);
                simulateProgress(60, 100, 100);
            }
        });

        document.getElementById("loginUser").addEventListener("click", async function () {
            const loginBtn = this;
            setBtnLoading(loginBtn, loginDots, true);
            simulateProgress(0, 50, 500);

            const email = document.getElementById("loginEmail").value.trim();
            const password = document.getElementById("loginPassword").value;

            if (!email) {
                showMessage(loginMessages, "Please enter your email", "error");
                setBtnLoading(loginBtn, loginDots, false);
                simulateProgress(50, 100, 100);
                return;
            }
            if (!password) {
                showMessage(loginMessages, "Please enter your password", "error");
                setBtnLoading(loginBtn, loginDots, false);
                simulateProgress(50, 100, 100);
                return;
            }

            try {
                showMessage(loginMessages, "Logging in...", "info");

                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                try {
                    await setDoc(doc(db, "users", user.uid), {
                        lastLogin: serverTimestamp()
                    }, { merge: true });
                } catch (updateError) {
                    console.error("Error updating last login:", updateError);
                }

                simulateProgress(50, 100, 300);
                showMessage(loginMessages, "Login successful! Redirecting...", "success");

                // Set redirection as active
                redirectionActive = true;

                // 1 second delay before redirecting to dashboard
                setTimeout(() => {
                    toggleLoader(true);
                    window.location.href = "dashboard.html";
                }, 1000);
            } catch (error) {
                let errorMessage;

                if (error.code === 'auth/user-not-found') {
                    errorMessage = "No account found with this email address";
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = "Incorrect password. Please try again";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email format";
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = "Too many failed attempts. Please try again later";
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = "Network error. Please check your internet connection";
                } else {
                    errorMessage = "Login error. Please try again later";
                    console.error("Login error:", error);
                }

                showMessage(loginMessages, errorMessage, "error");
                setBtnLoading(loginBtn, loginDots, false);
                simulateProgress(50, 100, 100);
            }
        });

        document.getElementById("forgotPassword").addEventListener("click", function () {
            switchForm('resetPasswordForm');
        });

        document.getElementById("showSignup").addEventListener("click", function () {
            switchForm('signupForm');
            document.getElementById("fullName").focus();
        });

        document.getElementById("showLogin").addEventListener("click", function () {
            switchForm('loginForm');
            document.getElementById("loginEmail").focus();
        });

        // Resend verification code for registration
        resendCode.addEventListener('click', function () {
            const email = document.getElementById("signupEmail").value.trim();
            sendEmailVerificationCode(email);
        });

        // Key press events for form navigation
        document.getElementById("loginEmail").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.getElementById("loginPassword").focus();
            }
        });

        document.getElementById("loginPassword").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.getElementById("loginUser").click();
            }
        });

        document.getElementById("fullName").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.getElementById("signupCountry").focus();
            }
        });

        document.getElementById("signupCountry").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.getElementById("birthdate").focus();
            }
        });

        document.getElementById("birthdate").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.getElementById("signupEmail").focus();
            }
        });

        document.getElementById("signupEmail").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.getElementById("signupPassword").focus();
            }
        });

        document.getElementById("signupPassword").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.getElementById("confirmPassword").focus();
            }
        });

        document.getElementById("confirmPassword").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.getElementById("goToStep2").click();
            }
        });

        // Password reset events
        document.getElementById("resetEmail").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                document.getElementById("sendResetEmail").click();
            }
        });

        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/sw.js').then(function (registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function (err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>

</html>
